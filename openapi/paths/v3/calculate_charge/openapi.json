{
  "post": {
    "operationId": "CalculateCharge",
    "description": "Request to calculate a standalone charge based on a set of charge parameters, without creating a transaction. Input and output data is not retained in the CM.",
    "tags": [
      "calculate"
    ],
    "parameters": [
      {
        "name": "regime",
        "in": "path",
        "required": true,
        "description": "Charging regime to use",
        "schema": {
          "description": "Short reference for a regime, referred to as a 'slug'. This is also what we expect to see in the path as the regime identifier when making a request",
          "type": "string",
          "enum": [
            "cfd",
            "pas",
            "wml",
            "wrls"
          ],
          "example": "wrls"
        }
      }
    ],
    "responses": {
      "200": {
        "description": "Success",
        "content": {
          "application/json": {
            "examples": {
              "presroc": {
                "calculation": {
                  "chargeValue": 772,
                  "sourceFactor": 3,
                  "seasonFactor": 1.6,
                  "lossFactor": 0.03,
                  "licenceHolderChargeAgreement": null,
                  "chargeElementAgreement": null,
                  "eiucSourceFactor": 0,
                  "eiuc": 0,
                  "suc": 1495
                }
              },
              "sroc": {
                "calculation": {
                  "chargeValue": 3395,
                  "baseCharge": 9700,
                  "waterCompanyChargeValue": 0,
                  "supportedSourceValue": 0,
                  "winterOnlyFactor": null,
                  "section130Factor": 0.5,
                  "section127Factor": null,
                  "compensationChargePercent": 70
                }
              }
            }
          }
        }
      },
      "400": {
        "description": "Failed - issue with the Rules Service",
        "content": {
          "application/json": {
            "examples": {
              "Cannot connect to rules service": {
                "value": {
                  "statusCode": 400,
                  "error": "Bad Request",
                  "message": "Error communicating with the rules service: [error code]"
                }
              },
              "Rule service returned a 5xx": {
                "value": {
                  "statusCode": 400,
                  "error": "Bad Request",
                  "message": "Rules service error: [error message]"
                }
              }
            }
          }
        }
      },
      "403": {
        "description": "Failed - not authorised",
        "content": {
          "application/json": {
            "schema": {
              "example": {
                "statusCode": 403,
                "error": "Forbidden",
                "message": "Unauthorised for regime 'wrls'"
              }
            }
          }
        }
      },
      "422": {
        "description": "Failed - issue with the requested data",
        "content": {
          "application/json": {
            "examples": {
              "Ruleset not found": {
                "value": {
                  "statusCode": 422,
                  "error": "Unprocessable Entity",
                  "message": "Ruleset not found, please check periodStart value."
                }
              },
              "Rule service data error": {
                "value": {
                  "statusCode": 422,
                  "error": "Unprocessable Entity",
                  "message": "Rules service error: [error message]"
                }
              },
              "Rule service data message": {
                "value": {
                  "statusCode": 422,
                  "error": "Unprocessable Entity",
                  "message": "Rules service returned the following: [message]"
                }
              }
            }
          }
        }
      }
    },
    "requestBody": {
      "content": {
        "application/json": {
          "schema": {
            "oneOf": [
              {
                "title": "presroc schema",
                "type": "object",
                "properties": {
                  "ruleset": {
                    "description": "The scheme ruleset that applies",
                    "type": "string",
                    "enum": [
                      "sroc",
                      "presroc"
                    ],
                    "example": "presroc"
                  },
                  "periodStart": {
                    "description": "The start date of the charge period covered by a transaction",
                    "type": "string",
                    "example": "01-APR-2018"
                  },
                  "periodEnd": {
                    "description": "The end date of the charge period covered by a transaction",
                    "type": "string",
                    "example": "31-MAR-2019"
                  },
                  "credit": {
                    "description": "Boolean indicator to show whether the transaction is a credit (negative value)",
                    "type": "boolean",
                    "example": false
                  },
                  "billableDays": {
                    "description": "The number of days covered by a charge",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 366,
                    "example": 149
                  },
                  "authorisedDays": {
                    "description": "The number of days per year in which abstraction is authorised under the terms of the licence",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 366,
                    "example": 214
                  },
                  "volume": {
                    "description": "The volume (in thousands of cubic metres) on which the charge is based",
                    "type": "number",
                    "minimum": 0,
                    "example": 19.909
                  },
                  "source": {
                    "description": "Source on which standard charge calculation based",
                    "type": "string",
                    "enum": [
                      "Supported",
                      "Kielder",
                      "Unsupported",
                      "Tidal"
                    ],
                    "example": "Unsupported"
                  },
                  "season": {
                    "description": "Season on which charge calculation based",
                    "type": "string",
                    "enum": [
                      "Summer",
                      "Winter",
                      "All Year"
                    ],
                    "example": "Summer"
                  },
                  "loss": {
                    "description": "Loss on which charge calculation based",
                    "type": "string",
                    "enum": [
                      "High",
                      "Medium",
                      "Low",
                      "Very Low"
                    ],
                    "example": "Medium"
                  },
                  "twoPartTariff": {
                    "description": "Boolean indicator to show whether the transaction is for the second part of a 2-part tariff charge",
                    "type": "boolean",
                    "example": true
                  },
                  "compensationCharge": {
                    "description": "Boolean indicator to show whether the transaction relates to a compensation charge",
                    "type": "boolean",
                    "example": false
                  },
                  "eiucSource": {
                    "description": "Source on which compensation charge calculation based",
                    "type": "string",
                    "example": "Tidal"
                  },
                  "waterUndertaker": {
                    "description": "Boolean indicator to show whether the transaction is for a water undertaker",
                    "type": "boolean",
                    "example": false
                  },
                  "regionalChargingArea": {
                    "description": "The name of the region relevant to the determination of the SUC and / or EIUC value to be used in the calculation",
                    "type": "string",
                    "enum": [
                      "Anglian",
                      "Midlands",
                      "South West",
                      "North West",
                      "Southern",
                      "Thames",
                      "Northumbria",
                      "Yorkshire",
                      "Wales"
                    ],
                    "example": "Northumbria"
                  },
                  "section126Factor": {
                    "description": "The factor to apply to the charge where a section 126 charge agreement is relevant to the transaction",
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "example": 0.75
                  },
                  "section127Agreement": {
                    "description": "Indicator to show whether a section 127 charge agreement applies to the transaction",
                    "type": "boolean",
                    "example": false
                  },
                  "section130Agreement": {
                    "description": "Indicator to show whether a section 130 charge agreement applies to the transaction",
                    "type": "boolean",
                    "example": true
                  }
                },
                "required": [
                  "ruleset",
                  "periodStart",
                  "periodEnd",
                  "billableDays",
                  "authorisedDays",
                  "volume",
                  "source",
                  "season",
                  "loss",
                  "section130Agreement",
                  "section127Agreement",
                  "twoPartTariff",
                  "compensationCharge",
                  "regionalChargingArea",
                  "credit",
                  "waterUndertaker"
                ]
              },
              {
                "title": "sroc schema",
                "type": "object",
                "properties": {
                  "ruleset": {
                    "description": "The scheme ruleset that applies",
                    "type": "string",
                    "enum": [
                      "sroc",
                      "presroc"
                    ],
                    "example": "presroc"
                  },
                  "periodStart": {
                    "description": "The start date of the charge period covered by a transaction",
                    "type": "string",
                    "example": "01-APR-2018"
                  },
                  "periodEnd": {
                    "description": "The end date of the charge period covered by a transaction",
                    "type": "string",
                    "example": "31-MAR-2019"
                  },
                  "credit": {
                    "description": "Boolean indicator to show whether the transaction is a credit",
                    "type": "boolean",
                    "example": false
                  },
                  "abatementFactor": {
                    "description": "Factor to apply to a charge where an abatement applies",
                    "type": "number",
                    "default": 1,
                    "example": 0.5
                  },
                  "actualVolume": {
                    "description": "The actual volume of water abstracted by a licence holder",
                    "type": "number",
                    "minimum": 0,
                    "exclusiveMinimum": true,
                    "example": 5
                  },
                  "aggregateProportion": {
                    "description": "Factor to apply to cater for the proportioning of charges between licences where aggregation applies",
                    "type": "number",
                    "default": 1,
                    "example": 0.5
                  },
                  "authorisedDays": {
                    "description": "The number of days per year in which abstraction is authorised under the terms of the licence",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 366,
                    "example": 214
                  },
                  "authorisedVolume": {
                    "description": "The volume of water authorised for abstraction",
                    "type": "number",
                    "minimum": 0,
                    "exclusiveMinimum": true,
                    "example": 5
                  },
                  "billableDays": {
                    "description": "The number of days covered by a charge",
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 366,
                    "example": 149
                  },
                  "chargeCategoryCode": {
                    "description": "Reference number of the charge category to be applied to the charge",
                    "type": "string",
                    "example": "2.1.211"
                  },
                  "compensationCharge": {
                    "description": "Boolean indicator to show whether the transaction relates to a compensation charge",
                    "type": "boolean",
                    "example": false
                  },
                  "loss": {
                    "description": "Loss on which charge calculation based",
                    "type": "string",
                    "enum": [
                      "High",
                      "Medium",
                      "Low",
                      "Very Low"
                    ],
                    "example": "Medium"
                  },
                  "regionalChargingArea": {
                    "description": "Name of the region to be used when determining the regional factor to be applied for a compensation charge",
                    "type": "string",
                    "enum": [
                      "Anglian",
                      "Dee",
                      "Devon and Cornwall (South West)",
                      "Midlands",
                      "North and South Wessex",
                      "North West",
                      "Northumbria",
                      "South West (incl Wessex)",
                      "Southern",
                      "Thames",
                      "Wales",
                      "Wye",
                      "Yorkshire"
                    ],
                    "example": "Devon and Cornwall (South West)"
                  },
                  "section127Agreement": {
                    "description": "Indicator to show whether a section 127 charge agreement applies to the transaction",
                    "type": "boolean",
                    "example": false
                  },
                  "section130Agreement": {
                    "description": "Indicator to show whether a section 130 charge agreement applies to the transaction",
                    "type": "boolean",
                    "example": true
                  },
                  "supportedSource": {
                    "description": "Boolean indicator to show whether a supported source supplement is to be added to a charge",
                    "type": "string",
                    "enum": [
                      "Candover",
                      "Dee",
                      "Earl Soham - Deben",
                      "Glen Groundwater",
                      "Great East Anglian Groundwater",
                      "Great East Anglian Surface Water",
                      "Kielder",
                      "Lodes Granta Groundwater",
                      "Lower Yorkshire Derwent",
                      "Medway - Allington",
                      "Nene – Northampton",
                      "Nene – Water Newton",
                      "Ouse - Offord",
                      "Ouse – Eaton Socon",
                      "Ouse – Hermitage",
                      "Rhee Groundwater",
                      "Severn",
                      "Thames",
                      "Thet and Little Ouse Surface Water",
                      "Waveney Groundwater",
                      "Waveney Surface Water",
                      "Welland – Tinwell Sluices",
                      "Witham and Ancholme",
                      "Wye"
                    ],
                    "example": "Thames"
                  },
                  "twoPartTariff": {
                    "description": "Boolean indicator to show whether a transaction/charge request relates to the 2nd part of a two-part tariff bill",
                    "type": "boolean",
                    "example": true
                  },
                  "waterCompanyCharge": {
                    "description": "Boolean indicator to show whether the water company supplement is to be added to a charge",
                    "type": "boolean",
                    "example": true
                  },
                  "waterUndertaker": {
                    "description": "Boolean indicator to show whether the transaction is for a water undertaker",
                    "type": "boolean",
                    "example": false
                  },
                  "winterOnly": {
                    "description": "Boolean indicator to show whether a charge relates to a licence that authorises abstraction in the winter season only",
                    "type": "boolean",
                    "example": true
                  }
                },
                "required": [
                  "authorisedDays",
                  "authorisedVolume",
                  "billableDays",
                  "chargeCategoryCode",
                  "compensationCharge",
                  "credit",
                  "loss",
                  "periodEnd",
                  "periodStart",
                  "ruleset",
                  "section127Agreement",
                  "section130Agreement",
                  "supportedSource",
                  "twoPartTariff",
                  "waterCompanyCharge",
                  "winterOnly"
                ]
              }
            ]
          },
          "examples": {
            "presroc": {
              "value": {
                "ruleset": "presroc",
                "periodStart": "01-APR-2020",
                "periodEnd": "31-MAR-2021",
                "credit": false,
                "billableDays": 214,
                "authorisedDays": 214,
                "volume": "3.5865",
                "source": "Supported",
                "season": "Summer",
                "loss": "Low",
                "twoPartTariff": false,
                "compensationCharge": false,
                "eiucSource": "Tidal",
                "waterUndertaker": false,
                "regionalChargingArea": "Midlands",
                "section126Factor": 1,
                "section127Agreement": false,
                "section130Agreement": false
              }
            },
            "sroc": {
              "value": {
                "ruleset": "sroc",
                "periodStart": "01-APR-2022",
                "periodEnd": "31-MAR-2023",
                "credit": false,
                "billableDays": 214,
                "authorisedDays": 214,
                "abatementFactor": "1.0",
                "actualVolume": "2.0",
                "aggregateProportion": "1.0",
                "chargeCategoryCode": "2.1.211",
                "compensationCharge": true,
                "loss": "High",
                "regionalChargingArea": "Devon and Cornwall (South West)",
                "section127Agreement": false,
                "section130Agreement": true,
                "supportedSource": true,
                "supportedSourceName": "Candover",
                "twoPartTariff": false,
                "authorisedVolume": "2.0",
                "waterCompanyCharge": false,
                "waterUndertaker": false,
                "winterOnly": false
              }
            }
          }
        }
      }
    }
  }
}